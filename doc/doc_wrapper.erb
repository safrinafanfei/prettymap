<!doctype html>
<html>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Landline</title>
  <head>
    <style>
      /* reset */
      div, html, body {
        margin: 0;
        padding: 0;
        border: 0;
        vertical-align: baseline;
      }
      html {
        margin: 10px auto;
      }

      ul { list-style: none; padding-left: 10px;}
      li { margin-bottom: 1em; }

      <%= roadgeek %>

      /* text styles */
      body {
        font-family: "Helvetica Neue", Helvetica, sans-serif;
        font-size: 14px;
        line-height: 1.7em;
        margin-left: auto;
        margin-right: auto;
        padding: 20px;
        max-width:900px;
      }
      p, li {
        max-width:600px;
        margin: 0px 0px 1em;
      }

      h1, h2, h3 {
        max-width: 600px;
        font-family: "roadgeek_2005_series_emRg", "Helvetica Neue", Helvetica, arial, sans-serif;
        text-rendering: optimizeLegibility;
        margin: 1em 0 0.5em 0px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        border-top: 2px solid #444;
        padding: 5px;
        background: #cec;      
      }

      h1 {
        margin-top:0;
      }

      h2 {
        padding:3px;
      }

      h3 {
        padding:0px 2px;
        border-top:1px solid #444;
      }

      h4 {
        margin: 0px;
        margin-top: 30px;
        margin-left: -5px;
        font-weight: normal;
      }

      h4 code {
        padding: 4px;
        background-color: #e6f3ff;
      }

      ol {
        padding-left: 0px;
      }

      code, pre, tt { font-family: Monaco, monospace; font-size: 12px; }
      tt { border:1px solid #efefef; padding: 2px;}
      dd { margin-left: 0; }
      dt { margin-left: 1em; }

      a { color: black; }
      a:hover { text-decoration: none; }
      pre {
        padding-left: 10px;
        font-size: 12px;
        border-left: 5px solid #efefef;
        line-height: 1.3;
      }

      hr {
        border: 0;
        border-top: 1px solid #efefef;
        height: 1px;
      }

      /* styles stolen from docco */
      body .hll { background-color: #ffffcc }
      body .c { color: #999999; font-style: italic }  /* Comment */
      /* body .err { border: 1px solid #FF0000 }*/         /* Error */
      body .k { color: #954121 }                      /* Keyword */
      body .o { color: #666666 }                      /* Operator */
      body .cm { color: #999999; font-style: italic } /* Comment.Multiline */
      body .cp { color: #999999 }                     /* Comment.Preproc */
      body .c1 { color: #999999; font-style: italic } /* Comment.Single */
      body .cs { color: #999999; font-style: italic } /* Comment.Special */
      body .gd { color: #A00000 }                     /* Generic.Deleted */
      body .ge { font-style: italic }                 /* Generic.Emph */
      body .gr { color: #FF0000 }                     /* Generic.Error */
      body .gh { color: #000080; font-weight: bold }  /* Generic.Heading */
      body .gi { color: #00A000 }                     /* Generic.Inserted */
      body .go { color: #808080 }                     /* Generic.Output */
      body .gp { color: #000080; font-weight: bold }  /* Generic.Prompt */
      body .gs { font-weight: bold }                  /* Generic.Strong */
      body .gu { color: #800080; font-weight: bold }  /* Generic.Subheading */
      body .gt { color: #0040D0 }                     /* Generic.Traceback */
      body .kc { color: #954121 }                     /* Keyword.Constant */
      body .kd { color: #954121; font-weight: bold }  /* Keyword.Declaration */
      body .kn { color: #954121; font-weight: bold }  /* Keyword.Namespace */
      body .kp { color: #954121 }                     /* Keyword.Pseudo */
      body .kr { color: #954121; font-weight: bold }  /* Keyword.Reserved */
      body .kt { color: #B00040 }                     /* Keyword.Type */
      body .m { color: #666666 }                      /* Literal.Number */
      body .s { color: #219161 }                      /* Literal.String */
      body .na { color: #7D9029 }                     /* Name.Attribute */
      body .nb { color: #954121 }                     /* Name.Builtin */
      body .nc { color: #0000FF; font-weight: bold }  /* Name.Class */
      body .no { color: #880000 }                     /* Name.Constant */
      body .nd { color: #AA22FF }                     /* Name.Decorator */
      body .ni { color: #999999; font-weight: bold }  /* Name.Entity */
      body .ne { color: #D2413A; font-weight: bold }  /* Name.Exception */
      body .nf { color: #0000FF }                     /* Name.Function */
      body .nl { color: #A0A000 }                     /* Name.Label */
      body .nn { color: #0000FF; font-weight: bold }  /* Name.Namespace */
      body .nt { color: #954121; font-weight: bold }  /* Name.Tag */
      body .nv { color: #19469D }                     /* Name.Variable */
      body .ow { color: #AA22FF; font-weight: bold }  /* Operator.Word */
      body .w { color: #bbbbbb }                      /* Text.Whitespace */
      body .mf { color: #666666 }                     /* Literal.Number.Float */
      body .mh { color: #666666 }                     /* Literal.Number.Hex */
      body .mi { color: #666666 }                     /* Literal.Number.Integer */
      body .mo { color: #666666 }                     /* Literal.Number.Oct */
      body .sb { color: #219161 }                     /* Literal.String.Backtick */
      body .sc { color: #219161 }                     /* Literal.String.Char */
      body .sd { color: #219161; font-style: italic } /* Literal.String.Doc */
      body .s2 { color: #219161 }                     /* Literal.String.Double */
      body .se { color: #BB6622; font-weight: bold }  /* Literal.String.Escape */
      body .sh { color: #219161 }                     /* Literal.String.Heredoc */
      body .si { color: #BB6688; font-weight: bold }  /* Literal.String.Interpol */
      body .sx { color: #954121 }                     /* Literal.String.Other */
      body .sr { color: #BB6688 }                     /* Literal.String.Regex */
      body .s1 { color: #219161 }                     /* Literal.String.Single */
      body .ss { color: #19469D }                     /* Literal.String.Symbol */
      body .bp { color: #954121 }                     /* Name.Builtin.Pseudo */
      body .vc { color: #19469D }                     /* Name.Variable.Class */
      body .vg { color: #19469D }                     /* Name.Variable.Global */
      body .vi { color: #19469D }                     /* Name.Variable.Instance */
      body .il { color: #666666 }                     /* Literal.Number.Integer.Long */

      .documentation-wrapper {
        margin: 0 auto;
        display: inherit;
      }

      #landline_container {
        width:95%;
        max-width:600px;
      }
      #landline_tooltip {
        position:absolute;
        background:#fff;
        z-index:999999;
        font-family: Helvetica, Arial, sans-serif;
        font-weight:bold;
        font-size:12px;
        padding:0 3px;
        border-radius:2px;
        box-shadow:0 0 5px #444;
        display:none;
      }
      #landline_tooltip h2 {
        margin:2px 0 3px 0;
        padding:3px;
        font-size:14px;
        border:none;
      }
      .tooltip_sub {
        font-size:12px;
        font-weight:normal;
        display:inline-block;
        line-height:14px;
      }
      @media screen and (max-width:400px) {
        p {
          font-size:12px !important;
        }
        code, pre {
          font-size:10px !important;
        }
      }
    </style>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.2/raphael-min.js"></script>
    <script src="public/javascripts/states/states_packaged.js"></script>
    <script src="public/javascripts/states/states_options.js"></script>
    <script src="public/javascripts/counties/counties_packaged.js"></script>
    <script src="public/javascripts/landline.js"></script>
    <script src="public/javascripts/landline.stateline.js"></script>
    <script type="text/jst" id="landline_tooltip_tmpl">
      <h2><%%= n %></h2>
      <span class="tooltip_sub">Median income<br>$<%%= med_income %><span class='tooltip_moe'><br>Â± $<%%= moe %></span></span>
    </script>
    <script>
      var census = {"01":["Alabama",21830,266],"02":["Alaska",29932,1140],"04":["Arizona",25307,247],"05":["Arkansas",21529,201],"06":["California",25971,104],"08":["Colorado",29237,430],"09":["Connecticut",31920,247],"10":["Delaware",28405,921],"11":["District of Columbia",38014,1708],"12":["Florida",23387,172],"13":["Georgia",24682,253],"15":["Hawaii",29786,621],"16":["Idaho",22166,317],"17":["Illinois",27301,120],"18":["Indiana",24801,269],"19":["Iowa",26717,254],"20":["Kansas",26299,284],"21":["Kentucky",21871,186],"22":["Louisiana",22416,215],"23":["Maine",24367,496],"24":["Maryland",34564,457],"25":["Massachusetts",31016,231],"26":["Michigan",23938,206],"27":["Minnesota",30094,193],"28":["Mississippi",20206,292],"29":["Missouri",23933,251],"30":["Montana",23536,553],"31":["Nebraska",26450,308],"32":["Nevada",26328,314],"33":["New Hampshire",30651,420],"34":["New Jersey",32158,208],"35":["New Mexico",22775,364],"36":["New York",28449,247],"37":["North Carolina",23946,258],"38":["North Dakota",29326,721],"39":["Ohio",24778,170],"40":["Oklahoma",23460,298],"41":["Oregon",24445,303],"42":["Pennsylvania",25874,144],"44":["Rhode Island",26840,524],"45":["South Carolina",22451,260],"46":["South Dakota",25866,439],"47":["Tennessee",22570,265],"48":["Texas",25227,122],"49":["Utah",25043,402],"50":["Vermont",26323,492],"51":["Virginia",30322,193],"53":["Washington",29109,337],"54":["West Virginia",21494,268],"55":["Wisconsin",26668,179],"56":["Wyoming",26778,725]};
    </script>
    <script>
      $(function() {
        var map = window.currentMap = new Landline.Stateline("#landline_container", "states", options);
        var tmpl = _.template($("#landline_tooltip_tmpl").html());

        map.on('mouseover', function(e, path, data) {
          data.existingStyle = (data.existingStyle || {});
          data.existingStyle["fill"]        = path.attr("fill");
          data.existingStyle["strokeWidth"] = path.attr("stroke-width");
          path.attr("fill", "#999").attr("stroke-width", 1);
        });

        map.on('mousemove', function(e, path, data) {
          $("#landline_tooltip").html(tmpl({n : data.get('n'), med_income : commaDelimit(census[data.fips][1]), moe : census[data.fips][2]})).css("left", e.pageX + 20).css("top", e.pageY + 20).show();
        });

        map.on('mouseout', function(e, path, data) {
          $("#landline_tooltip").hide();
          _(data.existingStyle).each(function(v, k) {
            path.attr(k, v);
          });
        });

        // Color ramp via ColorBrewer
        var incomeColor = function(income) {
          if (income < 23768) return "rgb(237,248,233)";
          if (income < 27329) return "rgb(186,228,179)";
          if (income < 30891) return "rgb(116,196,118)";
          if (income < 34452) return "rgb(49,163,84)";
          return "rgb(0,109,44)";
        };

        var commaDelimit = function(a){
          return _.isNumber(a) ? a.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,") : "";
        };

        _(census).each(function(ary, fips) {
          map.style(fips, "fill", incomeColor(ary[1]));
        })
        map.createMap();
      });
    </script>
  </head>
  <body>
    <h1>Landline + Stateline <%= version %></h1>
    <p><a href="https://github.com/propublica/landline/blob/master/public/javascripts/landline.js">Landline</a> is a JavaScript library that creates SVG maps from GeoJSON. It comes with <a href="https://github.com/propublica/landline/blob/master/public/javascripts/landline.stateline.js">Stateline</a>, which makes creating responsive U.S. state and county maps easy.</p>

    <p>The source is at <a href="https://github.com/propublica/landline">Github</a>. Please report issues or ask questions in the <a href="https://github.com/propublica/landline/issues">issue tracker</a>.</p>

    <div id="landline_container"></div>
    <div id="code_refer">
      <a href="#full_example">See the code for this demo</a>
    </div>
    <%= mdown %>
    <p style="float:left;margin-right:10px;"><a href="http://propublica.org"><img src="http://projects.propublica.org/nyc-flood/assets/logo-mini.png"></a></p>
    <p style="float:left;"><a href="http://opennews.org" class="org-logo"><img style="height:35px;" src="http://ryanpitts.github.io/listfilter/img/opennews-logo.png"></a></p>
    <p style="clear:both;"><a href="http://opennews.org/code.html">Released for OpenNews Code Convening, April 2014</a></p>
    <div id="landline_tooltip"></div>
  </body>
</html>
